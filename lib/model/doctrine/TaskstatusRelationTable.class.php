<?php

/**
 * TaskstatusRelationTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class TaskstatusRelationTable extends Doctrine_Table {

    /**
     * Returns an instance of this class.
     *
     * @return object TaskstatusRelationTable
     */
    public static function getInstance() {
        return Doctrine_Core::getTable('TaskstatusRelation');
    }

    public static function formatData($array, $page) {
        $rows = TaskstatusTable::formatData(array(), 1, count($array));

        $pos = 0;
        foreach ($array as $row) {
            $taskstatus = TaskstatusTable::formatData(array($row->getToTaskstatus()), 1, 1);

            $rows['data'][$pos] = $taskstatus['data'][0];

            $pos++;
        }

        $rows['metaData']['fields'] = array_merge($rows['metaData']['fields'], array(
            array('name' => 'fromstatus_id', 'type' => 'int'),
            array('name' => 'tostatus_id', 'type' => 'int'),
                ));


        return $rows;
    }

    public static function getAll($query, $distinct = false) {
        $q = Doctrine_Query::create()
                ->from('TaskstatusRelation cbr');

        if ($distinct) {
            $where = '';
            $params = array();
            for ($i = 0; $i < count($distinct); $i++) {
                if ($i == 0)
                    $where = $where . 'cbr.id != ?';
                else
                    $where = $where . ' AND cbr.id != ?';
                $params[] = $distinct[$i]->id;
            }
            $q->addWhere($where, $params);
        }

        if ($query && $query != '')
            $q = Doctrine_Query::create()
                    ->select('cbr.*')
                    ->from('TaskstatusRelation cbr')
                    ->where('cbr.fromstatus_id = ?', $query);

        return self::formatData($q->execute(), 1);
    }

}